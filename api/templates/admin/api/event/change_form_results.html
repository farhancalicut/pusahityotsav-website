{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block content %}
<div>
    <h1>Add/Edit Results for: {{ event.name }}</h1>
    <form method="post">
        {% csrf_token %}

        {{ form.event }}

        <div class="form-row">
    <label>Event:</label>
    <p><strong>{{ event.name }}</strong></p>
</div>

<div class="form-row">
    {{ form.winner_1.label_tag }}
    {{ form.winner_1 }}
    {{ form.winner_1.errors }}
</div>
<div class="form-row">
    {{ form.points_1.label_tag }}
    {{ form.points_1 }}
    {{ form.points_1.errors }}
</div>
<div class="form-row">
    {{ form.winner_2.label_tag }}
    {{ form.winner_2 }}
    {{ form.winner_2.errors }}
</div>
<div class="form-row">
    {{ form.points_2.label_tag }}
    {{ form.points_2 }}
    {{ form.points_2.errors }}
</div>
<div class="form-row">
    {{ form.winner_3.label_tag }}
    {{ form.winner_3 }}
    {{ form.winner_3.errors }}
</div>
<div class="form-row">
    {{ form.points_3.label_tag }}
    {{ form.points_3 }}
    {{ form.points_3.errors }}
</div>
<div class="form-row">
    {{ form.result_number.label_tag }}
    {{ form.result_number }}
    {{ form.result_number.errors }}
</div>
<div class="submit-row">
    <input type="submit" value="Save Results">
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const winner1Select = document.getElementById('id_winner_1');
        const winner2Select = document.getElementById('id_winner_2');
        const winner3Select = document.getElementById('id_winner_3');
        const allWinnerSelects = [winner1Select, winner2Select, winner3Select];

        const eventId = "{{ event.id|escapejs }}";

        fetch(`/api/get-registrations/${eventId}/`)
            .then(response => response.json())
            .then(data => {
                allWinnerSelects.forEach(select => {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">---------</option>';
                    data.forEach(reg => {
                        const option = document.createElement('option');
                        option.value = reg.id;
                        option.textContent = reg.name;
                        select.appendChild(option);
                    });
                    select.value = currentValue;
                });
            });
    });
</script>
{% endblock %}